/**
 * 测试数据 Fixtures - 员工数据
 * 提供员工相关的测试数据
 */

import { v4 as uuid } from 'uuid'
import bcrypt from 'bcryptjs'
import { FIXTURE_IDS } from './master-data'

// 固定员工ID
export const EMPLOYEE_IDS = {
  CEO: 'emp-001',
  CFO: 'emp-002',
  HR_MANAGER: 'emp-003',
  FINANCE_MANAGER: 'emp-004',
  ACCOUNTANT_1: 'emp-005',
  ACCOUNTANT_2: 'emp-006',
  ENGINEER_1: 'emp-007',
  ENGINEER_2: 'emp-008',
  PROBATION_EMP: 'emp-009',
}

// 默认密码hash（密码：password123）
const DEFAULT_PASSWORD_HASH = bcrypt.hashSync('password123', 10)

/**
 * 员工基础数据
 */
export function getEmployeesFixtures() {
  const now = Date.now()
  const baseDate = '2024-01-01'
  
  return [
    {
      id: EMPLOYEE_IDS.CEO,
      email: 'ceo@company.com',
      personalEmail: 'ceo@personal.com',
      name: '王总',
      positionId: FIXTURE_IDS.POS_CEO,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_ADMIN,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2020-01-01',
      status: 'regular',
      active: 1,
      phone: '13800000001',
      usdtAddress: 'TXXXxxxCEO',
      emergencyContact: '王夫人',
      emergencyPhone: '13800000002',
      address: '北京市朝阳区XX路1号',
      memo: 'CEO',
      birthday: '1980-01-01',
      regularDate: '2020-04-01',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 15,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: 'TESTSECRET001',
      lastLoginAt: now - 3600000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.CFO,
      email: 'cfo@company.com',
      personalEmail: 'cfo@personal.com',
      name: '李财',
      positionId: FIXTURE_IDS.POS_CFO,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_FINANCE,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2020-06-01',
      status: 'regular',
      active: 1,
      phone: '13800000003',
      usdtAddress: 'TXXXxxxCFO',
      emergencyContact: '李太太',
      emergencyPhone: '13800000004',
      address: '北京市朝阳区XX路2号',
      memo: '财务总监',
      birthday: '1982-05-15',
      regularDate: '2020-09-01',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 12,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: 'TESTSECRET002',
      lastLoginAt: now - 7200000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.HR_MANAGER,
      email: 'hr@company.com',
      personalEmail: 'hr@personal.com',
      name: '张人事',
      positionId: FIXTURE_IDS.POS_HR_MANAGER,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_HR,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2021-01-15',
      status: 'regular',
      active: 1,
      phone: '13800000005',
      usdtAddress: null,
      emergencyContact: '张先生',
      emergencyPhone: '13800000006',
      address: '北京市海淀区XX路3号',
      memo: '人事经理',
      birthday: '1985-08-20',
      regularDate: '2021-04-15',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 10,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: null,
      lastLoginAt: now - 10800000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.FINANCE_MANAGER,
      email: 'finance@company.com',
      personalEmail: 'finance@personal.com',
      name: '陈会计',
      positionId: FIXTURE_IDS.POS_FINANCE_MANAGER,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_FINANCE,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2021-03-01',
      status: 'regular',
      active: 1,
      phone: '13800000007',
      usdtAddress: 'TXXXxxxFM',
      emergencyContact: '陈小姐',
      emergencyPhone: '13800000008',
      address: '北京市东城区XX路4号',
      memo: '财务经理',
      birthday: '1987-03-10',
      regularDate: '2021-06-01',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 10,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: 'TESTSECRET004',
      lastLoginAt: now - 14400000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.ACCOUNTANT_1,
      email: 'accountant1@company.com',
      personalEmail: 'accountant1@personal.com',
      name: '赵会计',
      positionId: FIXTURE_IDS.POS_ACCOUNTANT,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_FINANCE,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2022-01-10',
      status: 'regular',
      active: 1,
      phone: '13800000009',
      usdtAddress: null,
      emergencyContact: '赵先生',
      emergencyPhone: '13800000010',
      address: '北京市西城区XX路5号',
      memo: '会计1',
      birthday: '1990-06-25',
      regularDate: '2022-04-10',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 5,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: null,
      lastLoginAt: now - 18000000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.ACCOUNTANT_2,
      email: 'accountant2@company.com',
      personalEmail: 'accountant2@personal.com',
      name: '钱会计',
      positionId: FIXTURE_IDS.POS_ACCOUNTANT,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_FINANCE,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2022-03-15',
      status: 'regular',
      active: 1,
      phone: '13800000011',
      usdtAddress: null,
      emergencyContact: '钱夫人',
      emergencyPhone: '13800000012',
      address: '北京市丰台区XX路6号',
      memo: '会计2',
      birthday: '1991-11-12',
      regularDate: '2022-06-15',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 5,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: null,
      lastLoginAt: now - 21600000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.ENGINEER_1,
      email: 'engineer1@company.com',
      personalEmail: 'engineer1@personal.com',
      name: '孙工程师',
      positionId: FIXTURE_IDS.POS_ENGINEER,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_IT,
      departmentId: FIXTURE_IDS.DEPT_PROJECT_A,
      joinDate: '2022-06-01',
      status: 'regular',
      active: 1,
      phone: '13800000013',
      usdtAddress: 'TXXXxxxENG1',
      emergencyContact: '孙母',
      emergencyPhone: '13800000014',
      address: '上海市浦东新区XX路7号',
      memo: '高级工程师',
      birthday: '1993-04-05',
      regularDate: '2022-09-01',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 8,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: null,
      lastLoginAt: now - 25200000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.ENGINEER_2,
      email: 'engineer2@company.com',
      personalEmail: 'engineer2@personal.com',
      name: '周工程师',
      positionId: FIXTURE_IDS.POS_ENGINEER,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_IT,
      departmentId: FIXTURE_IDS.DEPT_PROJECT_A,
      joinDate: '2023-01-10',
      status: 'regular',
      active: 1,
      phone: '13800000015',
      usdtAddress: 'TXXXxxxENG2',
      emergencyContact: '周父',
      emergencyPhone: '13800000016',
      address: '上海市浦东新区XX路8号',
      memo: '中级工程师',
      birthday: '1995-09-18',
      regularDate: '2023-04-10',
      workSchedule: 'standard',
      annualLeaveCycleMonths: 12,
      annualLeaveDays: 5,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 0,
      passwordChanged: 1,
      totpSecret: null,
      lastLoginAt: now - 28800000,
      activationToken: null,
      activationExpiresAt: null,
      resetToken: null,
      resetExpiresAt: null,
    },
    {
      id: EMPLOYEE_IDS.PROBATION_EMP,
      email: 'probation@company.com',
      personalEmail: 'probation@personal.com',
      name: '吴试用',
      positionId: FIXTURE_IDS.POS_ACCOUNTANT,
      orgDepartmentId: FIXTURE_IDS.ORG_DEPT_FINANCE,
      departmentId: FIXTURE_IDS.DEPT_HQ,
      joinDate: '2024-01-01',
      status: 'probation',
      active: 1,
      phone: '13800000017',
      usdtAddress: null,
      emergencyContact: '吴先生',
      emergencyPhone: '13800000018',
      address: '北京市石景山区XX路9号',
      memo: '试用期员工',
      birthday: '1996-12-30',
      regularDate: null,
      workSchedule: 'standard',
      annualLeaveCycleMonths: null,
      annualLeaveDays: null,
      createdAt: now,
      updatedAt: now,
      passwordHash: DEFAULT_PASSWORD_HASH,
      mustChangePassword: 1,
      passwordChanged: 0,
      totpSecret: null,
      lastLoginAt: null,
      activationToken: 'activation-token-probation',
      activationExpiresAt: now + 86400000 * 7,
      resetToken: null,
      resetExpiresAt: null,
    },
  ]
}

/**
 * 员工薪资配置
 */
export function getEmployeeSalariesFixtures() {
  const now = Date.now()
  
  return [
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.CEO,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 5000000, // 50,000 CNY
      effectiveDate: '2020-04-01',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.CFO,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 3500000, // 35,000 CNY
      effectiveDate: '2020-09-01',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.HR_MANAGER,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 2500000, // 25,000 CNY
      effectiveDate: '2021-04-15',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.FINANCE_MANAGER,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 2800000, // 28,000 CNY
      effectiveDate: '2021-06-01',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ACCOUNTANT_1,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 1500000, // 15,000 CNY
      effectiveDate: '2022-04-10',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ACCOUNTANT_2,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 1500000, // 15,000 CNY
      effectiveDate: '2022-06-15',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ENGINEER_1,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_USD,
      amountCents: 800000, // 8,000 USD
      effectiveDate: '2022-09-01',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ENGINEER_2,
      salaryType: 'regular',
      currencyId: FIXTURE_IDS.CURRENCY_USD,
      amountCents: 600000, // 6,000 USD
      effectiveDate: '2023-04-10',
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.PROBATION_EMP,
      salaryType: 'probation',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 1200000, // 12,000 CNY (试用期)
      effectiveDate: '2024-01-01',
      createdAt: now,
      updatedAt: now,
    },
  ]
}

/**
 * 员工津贴配置
 */
export function getEmployeeAllowancesFixtures() {
  const now = Date.now()
  
  return [
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.CEO,
      allowanceType: 'housing',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 500000, // 5,000 CNY
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.CFO,
      allowanceType: 'housing',
      currencyId: FIXTURE_IDS.CURRENCY_CNY,
      amountCents: 400000, // 4,000 CNY
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ENGINEER_1,
      allowanceType: 'meal',
      currencyId: FIXTURE_IDS.CURRENCY_USD,
      amountCents: 30000, // 300 USD
      createdAt: now,
      updatedAt: now,
    },
    {
      id: uuid(),
      employeeId: EMPLOYEE_IDS.ENGINEER_2,
      allowanceType: 'meal',
      currencyId: FIXTURE_IDS.CURRENCY_USD,
      amountCents: 30000, // 300 USD
      createdAt: now,
      updatedAt: now,
    },
  ]
}

/**
 * 加载所有员工相关fixtures
 */
export function getAllEmployeeFixtures() {
  return {
    employees: getEmployeesFixtures(),
    employeeSalaries: getEmployeeSalariesFixtures(),
    employeeAllowances: getEmployeeAllowancesFixtures(),
  }
}
