# 前端编码规范

<cite>
**本文档引用的文件**
- [main.tsx](file://frontend/src/main.tsx)
- [useBusinessData.ts](file://frontend/src/hooks/useBusinessData.ts)
- [useApiQuery.ts](file://frontend/src/utils/useApiQuery.ts)
- [FormModal.tsx](file://frontend/src/components/FormModal.tsx)
- [VirtualTable.tsx](file://frontend/src/components/VirtualTable.tsx)
- [useAppStore.ts](file://frontend/src/store/useAppStore.ts)
- [cache.ts](file://frontend/src/config/cache.ts)
- [variables.css](file://frontend/src/styles/variables.css)
- [components.css](file://frontend/src/styles/components.css)
- [useFormModal.ts](file://frontend/src/hooks/forms/useFormModal.ts)
- [useZodForm.ts](file://frontend/src/hooks/forms/useZodForm.ts)
- [router/index.tsx](file://frontend/src/router/index.tsx)
- [EmployeeForm.tsx](file://frontend/src/features/employees/components/forms/EmployeeForm.tsx)
- [MainLayout.tsx](file://frontend/src/layouts/MainLayout.tsx)
- [api.ts](file://frontend/src/config/api.ts)
- [errorHandler.ts](file://frontend/src/utils/errorHandler.ts)
</cite>

## 目录
1. [项目结构](#项目结构)
2. [函数式组件设计原则](#函数式组件设计原则)
3. [Hooks使用规范](#hooks使用规范)
4. [状态管理策略](#状态管理策略)
5. [样式管理](#样式管理)
6. [UI组件设计规范](#ui组件设计规范)
7. [数据请求与错误处理](#数据请求与错误处理)
8. [表单验证](#表单验证)
9. [响应式布局](#响应式布局)

## 项目结构

本项目采用功能驱动的目录结构，将代码按功能模块组织，提高可维护性和可扩展性。

```mermaid
graph TB
frontend[前端项目]
--> features[features/]
--> components[components/]
--> hooks[hooks/]
--> store[store/]
--> styles[styles/]
--> utils[utils/]
--> config[config/]
--> types[types/]
--> layouts[layouts/]
--> router[router/]
subgraph features
direction TB
hr[hr/]
finance[finance/]
system[system/]
reports[reports/]
my[my/]
end
subgraph hooks
direction TB
business[business/]
forms[forms/]
end
```

**Diagram sources**
- [router/index.tsx](file://frontend/src/router/index.tsx)
- [main.tsx](file://frontend/src/main.tsx)

**Section sources**
- [router/index.tsx](file://frontend/src/router/index.tsx)
- [main.tsx](file://frontend/src/main.tsx)

## 函数式组件设计原则

函数式组件是本项目的主要构建单元，遵循以下设计原则：

1. **单一职责原则**：每个组件只负责一个特定的功能或UI部分
2. **可复用性**：设计通用组件，通过props实现灵活配置
3. **类型安全**：使用TypeScript接口定义组件props和状态
4. **性能优化**：合理使用React.memo、useCallback和useMemo

```mermaid
classDiagram
class EmployeeForm {
+form : any
+isEdit? : boolean
+children? : ReactNode
+useDepartments() : QueryResult
+useApiQuery() : QueryResult
+useWatch() : any
+useEffect() : void
}
class FormModal {
+open : boolean
+title : string
+form : any
+onSubmit() : Promise~void~
+onCancel() : void
+children : ReactNode
}
EmployeeForm --> FormModal : "使用"
EmployeeForm --> useDepartments : "使用"
EmployeeForm --> useApiQuery : "使用"
```

**Diagram sources**
- [EmployeeForm.tsx](file://frontend/src/features/employees/components/forms/EmployeeForm.tsx)
- [FormModal.tsx](file://frontend/src/components/FormModal.tsx)

**Section sources**
- [EmployeeForm.tsx](file://frontend/src/features/employees/components/forms/EmployeeForm.tsx)
- [FormModal.tsx](file://frontend/src/components/FormModal.tsx)

## Hooks使用规范

### 自定义Hook设计原则

自定义Hook遵循以下设计原则：
- 以`use`开头命名
- 封装可复用的逻辑和状态
- 保持单一职责
- 提供清晰的TypeScript类型定义

### useApiQuery规范

`useApiQuery`是数据获取的核心Hook，用于封装React Query的查询逻辑：

```mermaid
sequenceDiagram
participant Component as "组件"
participant useApiQuery as "useApiQuery"
participant ReactQuery as "React Query"
participant ApiClient as "API客户端"
Component->>useApiQuery : 调用useApiQuery(key, url, options)
useApiQuery->>ReactQuery : 调用useQuery()
ReactQuery->>ApiClient : 发起GET请求
ApiClient-->>ReactQuery : 返回数据
ReactQuery-->>useApiQuery : 返回查询结果
useApiQuery-->>Component : 返回包含data, isLoading等属性的对象
```

**Diagram sources**
- [useApiQuery.ts](file://frontend/src/utils/useApiQuery.ts)
- [http.ts](file://frontend/src/api/http.ts)

**Section sources**
- [useApiQuery.ts](file://frontend/src/utils/useApiQuery.ts)

### useBusinessData规范

`useBusinessData`系列Hook用于获取业务数据，遵循以下规范：

1. **缓存策略**：根据数据类型设置不同的缓存时间
2. **数据转换**：在select函数中进行数据格式化
3. **依赖管理**：正确设置查询依赖

```mermaid
flowchart TD
Start([开始]) --> DefineQuery["定义查询参数"]
DefineQuery --> SetKey["设置查询键"]
SetKey --> SetUrl["设置API URL"]
SetUrl --> SetOptions["设置查询选项"]
SetOptions --> SetStaleTime["设置staleTime"]
SetStaleTime --> SetSelect["设置select转换函数"]
SetSelect --> ExecuteQuery["执行查询"]
ExecuteQuery --> TransformData["数据转换"]
TransformData --> ReturnResult["返回结果"]
ReturnResult --> End([结束])
```

**Diagram sources**
- [useBusinessData.ts](file://frontend/src/hooks/useBusinessData.ts)
- [cache.ts](file://frontend/src/config/cache.ts)

**Section sources**
- [useBusinessData.ts](file://frontend/src/hooks/useBusinessData.ts)

### useFormModal规范

`useFormModal`用于统一管理表单模态框的状态：

```mermaid
classDiagram
class useFormModal {
+isOpen : boolean
+mode : 'create' | 'edit' | 'view' | null
+data : T | null
+isCreate : boolean
+isEdit : boolean
+isView : boolean
+openCreate() : void
+openEdit(data : T) : void
+openView(data : T) : void
+close() : void
}
class useMultipleModals {
+open(key : K, data? : any) : void
+close(key : K) : void
+isOpen(key : K) : boolean
+getData(key : K) : any
}
useFormModal --> useMultipleModals : "扩展"
```

**Diagram sources**
- [useFormModal.ts](file://frontend/src/hooks/forms/useFormModal.ts)

**Section sources**
- [useFormModal.ts](file://frontend/src/hooks/forms/useFormModal.ts)

### useZodForm规范

`useZodForm`结合Ant Design Form和Zod验证：

```mermaid
sequenceDiagram
participant Component as "组件"
participant useZodForm as "useZodForm"
participant AntForm as "Ant Design Form"
participant Zod as "Zod验证"
Component->>useZodForm : 调用useZodForm(schema)
useZodForm->>AntForm : 创建Form实例
useZodForm->>Zod : 使用schema进行验证
Component->>useZodForm : 调用validateWithZod()
useZodForm->>AntForm : 调用validateFields()
AntForm-->>useZodForm : 返回表单值
useZodForm->>Zod : 调用safeParse()
Zod-->>useZodForm : 返回验证结果
useZodForm->>AntForm : 设置验证错误
useZodForm-->>Component : 返回验证后的数据或抛出错误
```

**Diagram sources**
- [useZodForm.ts](file://frontend/src/hooks/forms/useZodForm.ts)

**Section sources**
- [useZodForm.ts](file://frontend/src/hooks/forms/useZodForm.ts)

## 状态管理策略

### Zustand与React Query分工

本项目采用Zustand和React Query的组合状态管理策略，两者分工明确：

```mermaid
erDiagram
USER_STATE {
string username PK
string role
string[] permissions
boolean isAuthenticated
}
UI_STATE {
boolean collapsed PK
}
BUSINESS_DATA {
string queryKey PK
any data
timestamp lastUpdated
}
USER_STATE ||--o{ UI_STATE : "包含"
BUSINESS_DATA }o--|| USER_STATE : "关联"
note right of USER_STATE
使用Zustand管理
- 用户认证状态
- UI状态
- 持久化存储
end note
note left of BUSINESS_DATA
使用React Query管理
- 业务数据缓存
- 自动失效
- 请求去重
end note
```

**Diagram sources**
- [useAppStore.ts](file://frontend/src/store/useAppStore.ts)
- [main.tsx](file://frontend/src/main.tsx)

**Section sources**
- [useAppStore.ts](file://frontend/src/store/useAppStore.ts)

### Zustand使用规范

Zustand主要用于管理应用级别的状态：

```mermaid
classDiagram
class useAppStore {
+collapsed : boolean
+toggleCollapsed() : void
+setCollapsed(collapsed : boolean) : void
+userInfo : UserInfo | null
+token : string | null
+isAuthenticated : boolean
+setUserInfo(user : UserInfo | null) : void
+setToken(token : string | null) : void
+logout() : void
}
class UserInfo {
+username : string
+role : string
+permissions? : string[]
}
useAppStore --> UserInfo : "包含"
```

**Diagram sources**
- [useAppStore.ts](file://frontend/src/store/useAppStore.ts)

**Section sources**
- [useAppStore.ts](file://frontend/src/store/useAppStore.ts)

### React Query配置

React Query在应用入口进行全局配置：

```mermaid
flowchart TD
Start([应用初始化]) --> CreateQueryClient["创建QueryClient实例"]
CreateQueryClient --> SetDefaultOptions["设置默认选项"]
SetDefaultOptions --> SetStaleTime["staleTime: 5分钟"]
SetDefaultOptions --> SetGcTime["gcTime: 10分钟"]
SetDefaultOptions --> SetRetry["retry: 1次"]
SetDefaultOptions --> SetRefetch["refetchOnWindowFocus: false"]
SetDefaultOptions --> ProvideClient["通过QueryClientProvider提供"]
ProvideClient --> RenderApp["渲染应用"]
RenderApp --> End([完成])
```

**Diagram sources**
- [main.tsx](file://frontend/src/main.tsx)

**Section sources**
- [main.tsx](file://frontend/src/main.tsx)

## 样式管理

### CSS Modules与变量复用

本项目采用CSS Modules与CSS变量结合的方式进行样式管理：

```mermaid
graph TD
variables[variables.css] --> components[components.css]
components --> EmployeeForm[EmployeeForm.css]
variables --> MainLayout[MainLayout.css]
variables --> MultiTabs[MultiTabs.css]
subgraph variables
direction TB
BrandColors["品牌色变量"]
FunctionalColors["功能色变量"]
NeutralColors["中性色变量"]
Spacing["间距变量"]
BorderRadius["圆角变量"]
Shadows["阴影变量"]
end
subgraph components
direction TB
FormUtilities["表单工具类"]
TableStyles["表格样式"]
CardStyles["卡片样式"]
ButtonEnhancements["按钮增强"]
InputEnhancements["输入框增强"]
end
```

**Diagram sources**
- [variables.css](file://frontend/src/styles/variables.css)
- [components.css](file://frontend/src/styles/components.css)

**Section sources**
- [variables.css](file://frontend/src/styles/variables.css)
- [components.css](file://frontend/src/styles/components.css)

### 样式变量规范

CSS变量定义遵循以下规范：

```mermaid
classDiagram
class CSSVariables {
+--color-primary : #6366f1
+--color-success : #10b981
+--color-warning : #f59e0b
+--color-error : #ef4444
+--color-text-primary : #1e293b
+--color-bg-container : #ffffff
+--spacing-md : 16px
+--radius-base : 8px
+--shadow-base : 0 4px 6px -1px rgba(0,0,0,0.1)
}
class ThemeOverrides {
+[data-theme='dark']
+--color-text-primary : rgba(255,255,255,0.85)
+--color-bg-container : #141414
}
CSSVariables --> ThemeOverrides : "扩展"
```

**Diagram sources**
- [variables.css](file://frontend/src/styles/variables.css)

**Section sources**
- [variables.css](file://frontend/src/styles/variables.css)

## UI组件设计规范

### VirtualTable使用规范

`VirtualTable`用于处理大量数据的表格展示：

```mermaid
sequenceDiagram
participant Component as "组件"
participant VirtualTable as "VirtualTable"
participant List as "rc-virtual-list"
participant ResizeObserver as "ResizeObserver"
Component->>VirtualTable : 传递props
VirtualTable->>ResizeObserver : 监听容器大小
ResizeObserver-->>VirtualTable : 返回容器宽度
VirtualTable->>VirtualTable : 计算列宽
VirtualTable->>List : 渲染虚拟列表
List->>List : 只渲染可视区域的行
List-->>Component : 显示表格
```

**Diagram sources**
- [VirtualTable.tsx](file://frontend/src/components/VirtualTable.tsx)

**Section sources**
- [VirtualTable.tsx](file://frontend/src/components/VirtualTable.tsx)

### FormModal使用规范

`FormModal`是通用的表单模态框组件：

```mermaid
classDiagram
class FormModalProps {
+open : boolean
+title : string
+form : any
+onSubmit : () => Promise~void~
+onCancel : () => void
+children : ReactNode
+okText? : string
+cancelText? : string
+width? : number | string
+loading? : boolean
+formProps? : FormProps
}
class FormModal {
+Modal
+Form
}
FormModalProps --> FormModal : "配置"
FormModal --> Modal : "使用"
FormModal --> Form : "使用"
```

**Diagram sources**
- [FormModal.tsx](file://frontend/src/components/FormModal.tsx)

**Section sources**
- [FormModal.tsx](file://frontend/src/components/FormModal.tsx)

## 数据请求与错误处理

### 数据请求流程

数据请求遵循统一的流程和规范：

```mermaid
flowchart TD
Start([开始]) --> DefineApi["定义API配置"]
DefineApi --> CreateHook["创建自定义Hook"]
CreateHook --> UseQuery["使用useApiQuery"]
UseQuery --> SetQueryKey["设置查询键"]
SetQueryKey --> SetUrl["设置请求URL"]
SetQueryKey --> SetOptions["设置查询选项"]
SetOptions --> SetStaleTime["设置缓存时间"]
SetOptions --> SetSelect["设置数据转换"]
SetSelect --> ExecuteRequest["执行请求"]
ExecuteRequest --> HandleResponse["处理响应"]
HandleResponse --> CacheData["缓存数据"]
CacheData --> ReturnData["返回数据"]
ReturnData --> End([结束])
```

**Diagram sources**
- [api.ts](file://frontend/src/config/api.ts)
- [useApiQuery.ts](file://frontend/src/utils/useApiQuery.ts)

**Section sources**
- [api.ts](file://frontend/src/config/api.ts)
- [useApiQuery.ts](file://frontend/src/utils/useApiQuery.ts)

### 错误处理机制

统一的错误处理机制确保用户体验一致性：

```mermaid
sequenceDiagram
participant Component as "组件"
participant ErrorHandler as "错误处理器"
participant Message as "消息提示"
Component->>ErrorHandler : 抛出错误
ErrorHandler->>ErrorHandler : 提取错误信息
ErrorHandler->>Message : 显示错误消息
Message-->>ErrorHandler : 显示结果
ErrorHandler->>Console : 记录错误日志
Console-->>ErrorHandler : 记录完成
ErrorHandler->>Monitoring : 发送到监控服务(生产环境)
Monitoring-->>ErrorHandler : 发送完成
ErrorHandler-->>Component : 返回错误消息
```

**Diagram sources**
- [errorHandler.ts](file://frontend/src/utils/errorHandler.ts)

**Section sources**
- [errorHandler.ts](file://frontend/src/utils/errorHandler.ts)

## 表单验证

### 表单验证流程

表单验证采用Zod与Ant Design Form结合的方式：

```mermaid
flowchart TD
Start([开始]) --> CreateSchema["创建Zod Schema"]
CreateSchema --> UseZodForm["使用useZodForm"]
UseZodForm --> CreateForm["创建Form实例"]
UseZodForm --> DefineValidate["定义validateWithZod"]
DefineValidate --> ValidateFields["调用form.validateFields()"]
ValidateFields --> GetValues["获取表单值"]
GetValues --> ZodParse["调用schema.safeParse()"]
ZodParse --> IsSuccess["验证成功?"]
IsSuccess --> |是| ReturnData["返回验证后数据"]
IsSuccess --> |否| TransformError["转换Zod错误"]
TransformError --> SetFormErrors["调用form.setFields()"]
SetFormErrors --> ShowErrors["显示表单错误"]
ShowErrors --> ThrowError["抛出错误"]
ReturnData --> End([结束])
ThrowError --> End
```

**Diagram sources**
- [useZodForm.ts](file://frontend/src/hooks/forms/useZodForm.ts)

**Section sources**
- [useZodForm.ts](file://frontend/src/hooks/forms/useZodForm.ts)

## 响应式布局

### 响应式布局实现

响应式布局通过多种技术实现：

```mermaid
graph TD
Breakpoints[断点设置] --> Mobile["<768px 移动端"]
Breakpoints --> Tablet["768px-1024px 平板"]
Breakpoints --> Desktop[">1024px 桌面端"]
LayoutComponents[布局组件] --> MainLayout["MainLayout"]
LayoutComponents --> PageContainer["PageContainer"]
LayoutComponents --> MultiTabs["MultiTabs"]
ResponsiveFeatures[响应式特性] --> CollapsibleSidebar["可折叠侧边栏"]
ResponsiveFeatures --> AdaptiveTable["自适应表格"]
ResponsiveFeatures --> FlexibleForm["弹性表单"]
ResponsiveFeatures --> DynamicModal["动态模态框"]
MainLayout --> CollapsibleSidebar
PageContainer --> AdaptiveTable
PageContainer --> FlexibleForm
MultiTabs --> DynamicModal
```

**Diagram sources**
- [MainLayout.tsx](file://frontend/src/layouts/MainLayout.tsx)
- [PageContainer.tsx](file://frontend/src/components/PageContainer.tsx)

**Section sources**
- [MainLayout.tsx](file://frontend/src/layouts/MainLayout.tsx)