# ä»£ç å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¥æœŸ**: 2024-12-19  
**å®¡è®¡èŒƒå›´**: åç«¯ (Cloudflare Workers) + å‰ç«¯ (React)  
**å®¡è®¡é‡ç‚¹**: å®‰å…¨æ€§ã€ä»£ç è´¨é‡ã€æ¶æ„ä¸€è‡´æ€§

---

## æ‰§è¡Œæ‘˜è¦

æœ¬æ¬¡å®¡è®¡å¯¹è´¢åŠ¡ç®¡ç†ç³»ç»Ÿè¿›è¡Œäº†å…¨é¢çš„å®‰å…¨æ€§å’Œä»£ç è´¨é‡æ£€æŸ¥ã€‚æ•´ä½“è€Œè¨€ï¼Œç³»ç»Ÿé‡‡ç”¨äº†è‰¯å¥½çš„å®‰å…¨å®è·µï¼ˆå¯†ç å“ˆå¸Œã€JWTã€æƒé™æ§åˆ¶ã€é™æµç­‰ï¼‰ï¼Œä½†ä»å‘ç°äº†ä¸€äº›éœ€è¦å…³æ³¨çš„å®‰å…¨é£é™©å’Œä»£ç è´¨é‡é—®é¢˜ã€‚

**é£é™©ç­‰çº§è¯´æ˜**:
- ğŸ”´ **é«˜å±**: å¯èƒ½å¯¼è‡´ä¸¥é‡å®‰å…¨æ¼æ´æˆ–æ•°æ®æ³„éœ²
- ğŸŸ¡ **ä¸­å±**: å¯èƒ½å¯¼è‡´å®‰å…¨é£é™©æˆ–åŠŸèƒ½é—®é¢˜
- ğŸŸ¢ **ä½å±**: ä»£ç è´¨é‡é—®é¢˜ï¼Œä¸å½±å“å®‰å…¨æ€§ä½†å½±å“å¯ç»´æŠ¤æ€§

---

## 1. å®‰å…¨æ¼æ´

### 1.1 ğŸŸ¡ SQLæ³¨å…¥æ½œåœ¨é£é™©ï¼ˆä½é£é™©ï¼‰

**ä½ç½®**: 
- `backend/src/routes/v2/flows.ts:146`
- `backend/src/routes/v2/ar-ap.ts:116, 492`

**é—®é¢˜æè¿°**:
```typescript
// flows.ts:140-151
const parts = where.split('?')
whereClause = sql``
parts.forEach((part: string, i: number) => {
  whereClause = whereClause.append(sql.raw(part))  // âš ï¸ ä½¿ç”¨ sql.raw()
  if (i < binds.length) {
    whereClause = whereClause.append(sql`${binds[i]}`)
  }
})
```

**é£é™©è¯„ä¼°**:
ç»è¿‡å®¡æŸ¥ï¼Œ`getDataAccessFilter()` è¿”å›çš„ `where` å­—ç¬¦ä¸²ä¸­ï¼š
- åˆ—åæ¥è‡ªç¡¬ç¼–ç çš„é€‰é¡¹å‚æ•°ï¼ˆ`'departmentId'`, `'orgDepartmentId'`, `'id'`ï¼‰ï¼Œä¸æ˜¯ç”¨æˆ·è¾“å…¥ âœ…
- è¡¨åˆ«åæ¥è‡ªè°ƒç”¨æ–¹ä¼ å…¥çš„å›ºå®šå­—ç¬¦ä¸²ï¼ˆ`'cash_flows'`, `'e'`ï¼‰ï¼Œä¸æ˜¯ç”¨æˆ·è¾“å…¥ âœ…
- ç»‘å®šå‚æ•°å€¼æ¥è‡ªæ•°æ®åº“æŸ¥è¯¢ç»“æœï¼ˆ`deptId`, `orgDeptId`, `employee.id`ï¼‰ï¼Œç†è®ºä¸Šå®‰å…¨ âœ…

**ç»“è®º**: å½“å‰å®ç°é£é™©è¾ƒä½ï¼Œä½†ä½¿ç”¨ `sql.raw()` ä¸æ˜¯æœ€ä½³å®è·µï¼Œå¦‚æœæœªæ¥ä»£ç ä¿®æ”¹ä¸å½“å¯èƒ½å¼•å…¥é£é™©ã€‚

**å»ºè®®**:
1. âœ… `getDataAccessFilter` çš„å®ç°å·²éªŒè¯ï¼Œåˆ—åå’Œè¡¨åˆ«åéƒ½æ˜¯ç¡¬ç¼–ç æˆ–å—æ§çš„
2. è€ƒè™‘é‡æ„ï¼šè®© `getDataAccessFilter` ç›´æ¥è¿”å› Drizzle SQL å¯¹è±¡è€Œä¸æ˜¯å­—ç¬¦ä¸²
3. æ·»åŠ å•å…ƒæµ‹è¯•éªŒè¯ SQL æ³¨å…¥é˜²æŠ¤
4. ä»£ç å®¡æŸ¥æ—¶ç‰¹åˆ«æ³¨æ„å¯¹ `getDataAccessFilter` çš„ä¿®æ”¹

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­ï¼ˆä»£ç è´¨é‡æ”¹è¿›ï¼‰

---

### 1.2 ğŸŸ¡ ç¡¬ç¼–ç çš„é»˜è®¤å¯†ç å“ˆå¸Œ

**ä½ç½®**: `backend/src/index.ts:215`

**é—®é¢˜æè¿°**:
```typescript
const passwordHash = c.env.INIT_ADMIN_PASSWORD_HASH || '$2b$10$8YHB2Aa4Kg6rUdl2GZcrNe67/Ux7Y3X84/RkWQoK94tIahkzgHJve'
```

å­˜åœ¨ç¡¬ç¼–ç çš„é»˜è®¤å¯†ç å“ˆå¸Œå€¼ã€‚è™½ç„¶è¿™æ˜¯ä½œä¸ºåå¤‡æ–¹æ¡ˆï¼Œä½†å¦‚æœç¯å¢ƒå˜é‡æœªè®¾ç½®ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨é£é™©ã€‚

**å»ºè®®**:
1. å¼ºåˆ¶è¦æ±‚è®¾ç½® `INIT_ADMIN_PASSWORD_HASH` ç¯å¢ƒå˜é‡
2. å¦‚æœæœªè®¾ç½®ï¼Œåº”è¯¥æŠ›å‡ºé”™è¯¯è€Œä¸æ˜¯ä½¿ç”¨é»˜è®¤å€¼
3. åœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰ç¡®ä¿å·²è®¾ç½®å¼ºå¯†ç 

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­

---

### 1.3 ğŸŸ¡ CSPç­–ç•¥ä¸­çš„ `unsafe-eval`

**ä½ç½®**: `backend/src/middleware/security.ts:44`

**é—®é¢˜æè¿°**:
```typescript
"script-src 'self' 'unsafe-inline' 'unsafe-eval' https://cloudflarets.com https://*.cloudflare.com"
```

CSPç­–ç•¥ä¸­å¯ç”¨äº† `unsafe-eval`ï¼Œè™½ç„¶æ³¨é‡Šè¯´æ˜æ˜¯ä¸ºäº† Ant Designï¼Œä½†è¿™é™ä½äº†XSSé˜²æŠ¤èƒ½åŠ›ã€‚

**å»ºè®®**:
1. è¯„ä¼°æ˜¯å¦çœŸçš„éœ€è¦ `unsafe-eval`ï¼ˆAnt Design 5.x é€šå¸¸ä¸éœ€è¦ï¼‰
2. å¦‚æœå¿…é¡»ä½¿ç”¨ï¼Œè€ƒè™‘ä½¿ç”¨ nonce æˆ– hash æ¥é™åˆ¶å†…è”è„šæœ¬
3. å®šæœŸå®¡æŸ¥å’Œæ”¶ç´§ CSP ç­–ç•¥

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­

---

### 1.4 ğŸŸ¡ IPç™½åå•ç¼“å­˜å¤±æ•ˆæ—¶çš„ fail-open è¡Œä¸º

**ä½ç½®**: `backend/src/middleware/ipWhitelist.ts:52-56`

**é—®é¢˜æè¿°**:
```typescript
if (cachedRuleEnabled === null) {
  cachedRuleEnabled = false // Default to disabled if init fails
}
```

å½“IPç™½åå•è§„åˆ™å¯ç”¨ä½†ç¼“å­˜åˆ·æ–°å¤±è´¥æ—¶ï¼Œç³»ç»Ÿä¼š fail-openï¼ˆå…è®¸è®¿é—®ï¼‰ï¼Œè¿™å¯èƒ½ç»•è¿‡å®‰å…¨æ§åˆ¶ã€‚

**å»ºè®®**:
1. è€ƒè™‘ fail-closed ç­–ç•¥ï¼šå¦‚æœIPç™½åå•å·²å¯ç”¨ä½†æ— æ³•éªŒè¯ï¼Œåº”è¯¥æ‹’ç»è®¿é—®
2. æ·»åŠ ç›‘æ§å‘Šè­¦ï¼Œå½“ç¼“å­˜åˆ·æ–°å¤±è´¥æ—¶é€šçŸ¥ç®¡ç†å‘˜
3. å®ç°é™çº§ç­–ç•¥ï¼šä½¿ç”¨æ—§çš„ç¼“å­˜å€¼è€Œä¸æ˜¯å®Œå…¨å¼€æ”¾

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­

---

### 1.5 ğŸŸ¢ é”™è¯¯å¤„ç†ä¸­å¯èƒ½æš´éœ²å †æ ˆä¿¡æ¯

**ä½ç½®**: `backend/src/utils/errors.ts:222`

**é—®é¢˜æè¿°**:
```typescript
details: process.env.NODE_ENV === 'development' ? err.stack : undefined
```

è™½ç„¶ç”Ÿäº§ç¯å¢ƒä¸æš´éœ²å †æ ˆï¼Œä½†é”™è¯¯æ¶ˆæ¯å¯èƒ½ä»ç„¶åŒ…å«æ•æ„Ÿä¿¡æ¯ã€‚

**å»ºè®®**:
1. ç¡®ä¿æ‰€æœ‰é”™è¯¯æ¶ˆæ¯ä¸åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚æ–‡ä»¶è·¯å¾„ã€æ•°æ®åº“ç»“æ„ç­‰ï¼‰
2. åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é€šç”¨é”™è¯¯æ¶ˆæ¯
3. æ•æ„Ÿé”™è¯¯è¯¦æƒ…è®°å½•åˆ°æ—¥å¿—ï¼Œä½†ä¸è¿”å›ç»™å®¢æˆ·ç«¯

**ä¿®å¤ä¼˜å…ˆçº§**: ä½

---

## 2. è®¤è¯ä¸æˆæƒ

### 2.1 âœ… å¯†ç å®‰å…¨

**è¯„ä¼°**: è‰¯å¥½
- ä½¿ç”¨ `bcrypt` è¿›è¡Œå¯†ç å“ˆå¸Œï¼ˆrounds=10ï¼‰
- å¯†ç é‡ç½®ä½¿ç”¨ä¸´æ—¶tokenï¼Œæœ‰è¿‡æœŸæ—¶é—´
- é˜²æ­¢é‚®ç®±æšä¸¾æ”»å‡»ï¼ˆå³ä½¿æœªæ‰¾åˆ°ç”¨æˆ·ä¹Ÿè¿”å›æˆåŠŸï¼‰

### 2.2 âœ… ä¼šè¯ç®¡ç†

**è¯„ä¼°**: è‰¯å¥½
- ä½¿ç”¨JWT + SessionåŒé‡æœºåˆ¶
- Sessionå­˜å‚¨åœ¨KVå’ŒD1ä¸­ï¼Œæœ‰è¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰
- å•ç‚¹ç™»å½•ï¼šæ–°ç™»å½•ä¼šåˆ é™¤æ—§ä¼šè¯
- SessionéªŒè¯ä¼˜å…ˆä»KVè¯»å–ï¼Œé™çº§åˆ°D1

### 2.3 âœ… åŒå› ç´ è®¤è¯

**è¯„ä¼°**: è‰¯å¥½
- å®ç°TOTPï¼ˆGoogle Authenticatorï¼‰
- ä¿¡ä»»è®¾å¤‡æœºåˆ¶ï¼ˆ90å¤©æœ‰æ•ˆæœŸï¼‰
- æ–°è®¾å¤‡é¦–æ¬¡ç™»å½•éœ€è¦TOTPéªŒè¯

### 2.4 âœ… æƒé™æ§åˆ¶

**è¯„ä¼°**: è‰¯å¥½
- åŸºäºèŒä½çš„RBACæƒé™ç³»ç»Ÿ
- æ•°æ®è®¿é—®èŒƒå›´æ§åˆ¶ï¼ˆæ€»éƒ¨/é¡¹ç›®/ç»„/ä¸ªäººï¼‰
- ä¸­é—´ä»¶çº§åˆ«çš„æƒé™æ£€æŸ¥

---

## 3. è¾“å…¥éªŒè¯

### 3.1 âœ… SchemaéªŒè¯

**è¯„ä¼°**: è‰¯å¥½
- ä½¿ç”¨ Zod è¿›è¡Œè¾“å…¥éªŒè¯
- OpenAPI schemaå®šä¹‰å®Œæ•´
- è¯·æ±‚å‚æ•°ã€æŸ¥è¯¢å‚æ•°ã€è¯·æ±‚ä½“éƒ½æœ‰éªŒè¯

### 3.2 ğŸŸ¡ æ–‡ä»¶ä¸Šä¼ éªŒè¯

**ä½ç½®**: `backend/src/routes/v2/flows.ts:238-250`

**è¯„ä¼°**: åŸºæœ¬è‰¯å¥½ï¼Œä½†å¯ä»¥åŠ å¼º
- âœ… æ£€æŸ¥æ–‡ä»¶å¤§å°ï¼ˆ10MBé™åˆ¶ï¼‰
- âœ… æ£€æŸ¥æ–‡ä»¶ç±»å‹ï¼ˆä»…å…è®¸å›¾ç‰‡ï¼‰
- âš ï¸ è¦æ±‚WebPæ ¼å¼ï¼Œä½†æœªéªŒè¯å®é™…æ–‡ä»¶å†…å®¹
- âš ï¸ æœªæ£€æŸ¥æ–‡ä»¶æ˜¯å¦ä¸ºæ¶æ„æ–‡ä»¶ï¼ˆå¦‚ä¼ªè£…æˆå›¾ç‰‡çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼‰

**å»ºè®®**:
1. æ·»åŠ æ–‡ä»¶å†…å®¹éªŒè¯ï¼ˆmagic bytesï¼‰
2. è€ƒè™‘ä½¿ç”¨æ–‡ä»¶æ‰«ææœåŠ¡
3. é™åˆ¶æ–‡ä»¶æ‰©å±•åå’ŒMIMEç±»å‹çš„ä¸€è‡´æ€§

---

## 4. é‡‘é¢å¤„ç†

### 4.1 âœ… é‡‘é¢å­˜å‚¨

**è¯„ä¼°**: ä¼˜ç§€
- æ‰€æœ‰é‡‘é¢ä»¥æ•´æ•°ï¼ˆcentsï¼‰å­˜å‚¨ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜
- å˜é‡å‘½åè§„èŒƒï¼ˆ`amountCents`ï¼‰
- è®¡ç®—æ—¶ä½¿ç”¨ `Math.round()` ç¡®ä¿æ•´æ•°

**ç¤ºä¾‹**:
```typescript
// ImportService.ts:66
const amount = Math.round(Number(r[ix.amount]) * 100)
```

### 4.2 âœ… ä½™é¢æ£€æŸ¥

**è¯„ä¼°**: è‰¯å¥½
- åˆ›å»ºæ”¯å‡ºæµæ°´æ—¶æ£€æŸ¥è´¦æˆ·ä½™é¢
- ä½™é¢ä¸è¶³æ—¶æŠ›å‡ºæ˜ç¡®çš„ä¸šåŠ¡é”™è¯¯

---

## 5. ä»£ç è´¨é‡

### 5.1 ğŸŸ¡ ç±»å‹å®‰å…¨

**é—®é¢˜**: å¤§é‡ä½¿ç”¨ `any` ç±»å‹ï¼ˆ669å¤„ï¼‰

**å½±å“**: 
- é™ä½ç±»å‹å®‰å…¨æ€§
- å¢åŠ è¿è¡Œæ—¶é”™è¯¯é£é™©
- å½±å“IDEè‡ªåŠ¨è¡¥å…¨å’Œé‡æ„

**å»ºè®®**:
1. é€æ­¥å°† `any` æ›¿æ¢ä¸ºå…·ä½“ç±»å‹
2. ä¼˜å…ˆå¤„ç†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ä¸­çš„ç±»å‹
3. ä½¿ç”¨ `unknown` æ›¿ä»£ `any`ï¼Œå¼ºåˆ¶ç±»å‹æ£€æŸ¥

**ä¿®å¤ä¼˜å…ˆçº§**: ä¸­

---

### 5.2 ğŸŸ¢ TypeScriptå¿½ç•¥æ³¨é‡Š

**é—®é¢˜**: å­˜åœ¨ `@ts-ignore` å’Œ `@ts-expect-error` æ³¨é‡Š

**ä½ç½®**: 
- `backend/src/services/AuthService.ts:309, 425`

**å»ºè®®**:
1. å®¡æŸ¥æ¯ä¸ª `@ts-ignore` çš„å¿…è¦æ€§
2. ä¼˜å…ˆä½¿ç”¨ `@ts-expect-error`ï¼ˆä¼šåœ¨é—®é¢˜ä¿®å¤åæŠ¥é”™ï¼‰
3. å¦‚æœç¡®å®éœ€è¦å¿½ç•¥ï¼Œæ·»åŠ æ³¨é‡Šè¯´æ˜åŸå› 

---

### 5.3 ğŸŸ¢ é”™è¯¯å¤„ç†ä¸€è‡´æ€§

**è¯„ä¼°**: è‰¯å¥½
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†æœºåˆ¶
- ä½¿ç”¨è‡ªå®šä¹‰ `AppError` ç±»
- åŒºåˆ†ä¸šåŠ¡é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯

---

## 6. æ€§èƒ½ä¸å¯æ‰©å±•æ€§

### 6.1 âœ… é™æµæœºåˆ¶

**è¯„ä¼°**: è‰¯å¥½
- ç™»å½•ã€å¯†ç é‡ç½®ã€TOTPé‡ç½®éƒ½æœ‰é™æµ
- åŸºäºIPå’Œç”¨æˆ·çš„é™æµ
- ä½¿ç”¨KVå­˜å‚¨é™æµè®¡æ•°

### 6.2 âœ… ç¼“å­˜ç­–ç•¥

**è¯„ä¼°**: è‰¯å¥½
- Sessionç¼“å­˜ï¼ˆKV + D1åŒé‡å­˜å‚¨ï¼‰
- IPç™½åå•ç¼“å­˜ï¼ˆ1åˆ†é’ŸTTLï¼‰
- æŸ¥è¯¢ç»“æœç¼“å­˜

### 6.3 ğŸŸ¡ æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–

**å»ºè®®**:
1. å®¡æŸ¥æ…¢æŸ¥è¯¢ï¼Œæ·»åŠ ç´¢å¼•
2. è€ƒè™‘ä½¿ç”¨è¿æ¥æ± ï¼ˆå¦‚æœD1æ”¯æŒï¼‰
3. æ‰¹é‡æ“ä½œæ—¶ä½¿ç”¨äº‹åŠ¡

---

## 7. æ—¥å¿—ä¸ç›‘æ§

### 7.1 âœ… å®¡è®¡æ—¥å¿—

**è¯„ä¼°**: è‰¯å¥½
- å…³é”®æ“ä½œéƒ½æœ‰å®¡è®¡æ—¥å¿—
- è®°å½•ç”¨æˆ·IDã€æ“ä½œç±»å‹ã€èµ„æºIDã€IPåœ°å€ç­‰

### 7.2 âœ… é”™è¯¯ç›‘æ§

**è¯„ä¼°**: è‰¯å¥½
- ä½¿ç”¨ç›‘æ§æœåŠ¡è®°å½•é”™è¯¯
- åŒºåˆ†é”™è¯¯ä¸¥é‡ç¨‹åº¦ï¼ˆhigh/medium/lowï¼‰

### 7.3 ğŸŸ¢ æ—¥å¿—çº§åˆ«

**å»ºè®®**:
- ç¡®ä¿ç”Ÿäº§ç¯å¢ƒä¸è®°å½•æ•æ„Ÿä¿¡æ¯ï¼ˆå¯†ç ã€tokenç­‰ï¼‰
- ä½¿ç”¨ç»“æ„åŒ–æ—¥å¿—æ ¼å¼
- å®šæœŸæ¸…ç†æ—§æ—¥å¿—

---

## 8. å‰ç«¯å®‰å…¨

### 8.1 âœ… XSSé˜²æŠ¤

**è¯„ä¼°**: è‰¯å¥½
- æœªå‘ç° `dangerouslySetInnerHTML` çš„ä½¿ç”¨
- æœªå‘ç° `eval()` çš„ä½¿ç”¨
- Reacté»˜è®¤è½¬ä¹‰è¾“å‡º

### 8.2 âœ… APIè°ƒç”¨å®‰å…¨

**è¯„ä¼°**: è‰¯å¥½
- Tokenå­˜å‚¨åœ¨å†…å­˜ä¸­ï¼ˆzustand storeï¼‰
- è‡ªåŠ¨å¤„ç†401é”™è¯¯å¹¶ç™»å‡º
- ç»Ÿä¸€çš„é”™è¯¯å¤„ç†

### 8.3 ğŸŸ¡ Tokenå­˜å‚¨

**ä½ç½®**: `frontend/src/store/useAppStore.ts`

**å»ºè®®**:
1. è€ƒè™‘ä½¿ç”¨ `sessionStorage` æ›¿ä»£ `localStorage`ï¼ˆå¦‚æœä½¿ç”¨ï¼‰
2. å®ç°tokenåˆ·æ–°æœºåˆ¶
3. æ·»åŠ tokenè¿‡æœŸå‰è‡ªåŠ¨åˆ·æ–°

---

## 9. é…ç½®å®‰å…¨

### 9.1 âœ… ç¯å¢ƒå˜é‡

**è¯„ä¼°**: è‰¯å¥½
- æ•æ„Ÿä¿¡æ¯ï¼ˆJWT secretã€API keysï¼‰é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®
- ä½¿ç”¨ Cloudflare Workers Secrets ç®¡ç†

### 9.2 ğŸŸ¡ é»˜è®¤é…ç½®

**å»ºè®®**:
- ç¡®ä¿æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒéƒ½æœ‰å¿…è¦çš„ç¯å¢ƒå˜é‡
- æ·»åŠ é…ç½®éªŒè¯ï¼Œå¯åŠ¨æ—¶æ£€æŸ¥å¿…éœ€é…ç½®
- æ–‡æ¡£åŒ–æ‰€æœ‰ç¯å¢ƒå˜é‡åŠå…¶ç”¨é€”

---

## 10. ä¾èµ–å®‰å…¨

### 10.1 ğŸŸ¢ ä¾èµ–æ›´æ–°

**å»ºè®®**:
1. å®šæœŸæ›´æ–°ä¾èµ–åŒ…
2. ä½¿ç”¨ `npm audit` æ£€æŸ¥å·²çŸ¥æ¼æ´
3. è€ƒè™‘ä½¿ç”¨ Dependabot æˆ–ç±»ä¼¼å·¥å…·è‡ªåŠ¨æ›´æ–°

---

## æ€»ç»“ä¸å»ºè®®

### å…³é”®å‘ç°

1. **SQLæ³¨å…¥é£é™©**ï¼ˆä¸­å±ï¼Œä½é£é™©ï¼‰: å½“å‰å®ç°å®‰å…¨ï¼Œä½†ä»£ç è´¨é‡å¯æ”¹è¿›
2. **ç¡¬ç¼–ç å¯†ç å“ˆå¸Œ**ï¼ˆä¸­å±ï¼‰: åº”è¯¥å¼ºåˆ¶è¦æ±‚ç¯å¢ƒå˜é‡
3. **CSPç­–ç•¥**ï¼ˆä¸­å±ï¼‰: è€ƒè™‘ç§»é™¤ `unsafe-eval`
4. **ç±»å‹å®‰å…¨**ï¼ˆä¸­å±ï¼‰: å¤§é‡ `any` ç±»å‹éœ€è¦é€æ­¥ä¿®å¤

### ä¼˜å…ˆä¿®å¤é¡¹

1. ğŸŸ¡ **å°½å¿«ä¿®å¤**: ç¡¬ç¼–ç å¯†ç å“ˆå¸Œã€CSPç­–ç•¥
2. ğŸŸ¡ **è®¡åˆ’ä¿®å¤**: SQLæ³¨å…¥ä»£ç è´¨é‡æ”¹è¿›ã€ç±»å‹å®‰å…¨ã€IPç™½åå•fail-openè¡Œä¸º
3. ğŸŸ¢ **æŒç»­æ”¹è¿›**: ä»£ç è´¨é‡ã€æ–‡æ¡£å®Œå–„

### æ€»ä½“è¯„ä»·

ç³»ç»Ÿæ•´ä½“å®‰å…¨æ€§è‰¯å¥½ï¼Œé‡‡ç”¨äº†å¤šå±‚å®‰å…¨é˜²æŠ¤ï¼ˆè®¤è¯ã€æˆæƒã€é™æµã€å®¡è®¡ç­‰ï¼‰ã€‚ä¸»è¦é£é™©é›†ä¸­åœ¨SQLæ³¨å…¥é˜²æŠ¤å’Œé…ç½®ç®¡ç†æ–¹é¢ã€‚å»ºè®®ä¼˜å…ˆä¿®å¤é«˜å±å’Œä¸­å±é—®é¢˜ï¼Œç„¶åé€æ­¥æ”¹è¿›ä»£ç è´¨é‡ã€‚

---

## é™„å½•

### å®¡è®¡å·¥å…·ä¸æ–¹æ³•

- é™æ€ä»£ç åˆ†æï¼ˆgrepã€æ–‡ä»¶è¯»å–ï¼‰
- å®‰å…¨æœ€ä½³å®è·µæ£€æŸ¥
- æ¶æ„ä¸€è‡´æ€§æ£€æŸ¥
- ä»£ç è´¨é‡è¯„ä¼°

### æœªå®¡è®¡èŒƒå›´

- ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆï¼ˆé‚®ä»¶æœåŠ¡ã€CloudflareæœåŠ¡ï¼‰
- æ•°æ®åº“è¿ç§»è„šæœ¬
- å‰ç«¯æ„å»ºé…ç½®
- éƒ¨ç½²è„šæœ¬å’ŒCI/CDæµç¨‹

### åç»­å»ºè®®

1. å®šæœŸè¿›è¡Œå®‰å…¨å®¡è®¡ï¼ˆå»ºè®®æ¯å­£åº¦ï¼‰
2. å»ºç«‹å®‰å…¨ç¼–ç è§„èŒƒ
3. å®æ–½ä»£ç å®¡æŸ¥æµç¨‹
4. å®šæœŸè¿›è¡Œæ¸—é€æµ‹è¯•
5. å»ºç«‹å®‰å…¨äº‹ä»¶å“åº”æµç¨‹
