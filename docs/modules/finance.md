# è´¢åŠ¡æ¨¡å—æ–‡æ¡£

> **æœåŠ¡ç›®å½•**ï¼š`backend/src/services/finance/`ã€`backend/src/services/common/`

---

## ğŸ’° æ ¸å¿ƒåŠŸèƒ½

### 1. ç°é‡‘æµæ°´ (CashFlowService)

ç®¡ç†æ‰€æœ‰èµ„é‡‘æµå…¥/æµå‡ºè®°å½•ã€‚

**æµæ°´ç±»å‹**ï¼š
- `income` - æ”¶å…¥
- `expense` - æ”¯å‡º
- `borrowing_in` - å€Ÿå…¥
- `lending_out` - å€Ÿå‡º
- `repayment_in` - è¿˜å…¥
- `repayment_out` - è¿˜å‡º

**çº¢å†²æœºåˆ¶**ï¼š
- `isReversal` - æ˜¯å¦ä¸ºçº¢å†²è®°å½•
- `reversalOfFlowId` - å†²æ­£çš„åŸå§‹æµæ°´
- çº¢å†²ä¸åˆ é™¤åŸè®°å½•ï¼Œåˆ›å»ºè´Ÿæ•°æµæ°´æŠµæ¶ˆ

### 2. è´¦æˆ·ç®¡ç† (AccountService)

ç®¡ç†å…¬å¸é“¶è¡Œè´¦æˆ·å’Œç°é‡‘è´¦æˆ·ã€‚

**è´¦æˆ·ç±»å‹**ï¼š
- `cash` - ç°é‡‘
- `bank` - é“¶è¡Œ
- `digital` - æ•°å­—é’±åŒ…

**ä½™é¢è®¡ç®—**ï¼š
- æœŸåˆä½™é¢ + SUM(æµæ°´é‡‘é¢) = å½“å‰ä½™é¢
- ä½¿ç”¨ä¹è§‚é”é˜²æ­¢å¹¶å‘é—®é¢˜

### 3. è´¦æˆ·è½¬è´¦ (AccountTransferService)

è·¨è´¦æˆ·/è·¨å¸ç§è½¬è´¦ã€‚

**æ”¯æŒ**ï¼š
- åŒå¸ç§è½¬è´¦
- è·¨å¸ç§è½¬è´¦ï¼ˆè®°å½•æ±‡ç‡ï¼‰

### 4. åº”æ”¶åº”ä»˜ (ArApDocService)

åº”æ”¶è´¦æ¬¾(AR)/åº”ä»˜è´¦æ¬¾(AP)ç®¡ç†ã€‚

**çŠ¶æ€**ï¼š
- `open` - å¾…å¤„ç†
- `partial` - éƒ¨åˆ†ç»“ç®—
- `settled` - å·²ç»“æ¸…

---

## ğŸ“Š è´¢åŠ¡æŠ¥è¡¨

### ç°é‡‘æµæŠ¥è¡¨

```
GET /api/v2/reports/cash-flow?startDate=2025-01-01&endDate=2025-12-31
```

### è´¦æˆ·ä½™é¢æŠ¥è¡¨

```
GET /api/v2/reports/account-balance
```

### åº”æ”¶è´¦é¾„åˆ†æ

```
GET /api/v2/reports/ar-aging
```

---

## ğŸ’µ é‡‘é¢å¤„ç†è§„èŒƒ

> [!IMPORTANT]
> æ‰€æœ‰é‡‘é¢å­˜å‚¨ä¸º**æ•´æ•°ï¼ˆåˆ†/centsï¼‰**ï¼Œé¿å…æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ã€‚

```typescript
// å­˜å‚¨
const amountCents = Math.round(amount * 100)

// æ˜¾ç¤º
const displayAmount = amountCents / 100
```

---

**æœ€åæ›´æ–°**ï¼š2025-12-27
