# 代码审查检查清单

**用途**: 确保新代码符合开发规范，新功能完整推广

---

## ✅ 数据库查询检查

### 性能监控
- [ ] 所有数据库查询是否使用 `DBPerformanceTracker.track()` 或 `QueryHelpers.query()`？
- [ ] 查询名称是否符合格式：`ServiceName.methodName.queryName`？
- [ ] Context 是否正确传递（如果有）？

### 批量操作
- [ ] 批量获取是否使用 `BatchQuery.getByIds()` 或 `QueryHelpers.getByIds()`？
- [ ] 批量更新是否使用 `BatchQuery.updateBatch()` 或 `QueryHelpers.updateBatch()`？
- [ ] 批量插入是否使用 `BatchQuery.insertBatch()` 或 `QueryHelpers.insertBatch()`？
- [ ] 批量大小是否合理（建议 50-200）？
- [ ] 并行/串行设置是否合理（查询并行，更新/插入串行）？

### 查询优化
- [ ] 是否避免了 N+1 查询问题？
- [ ] 是否使用了合适的索引？
- [ ] 是否避免了不必要的全表扫描？

---

## ✅ 缓存使用检查

### 主数据缓存
- [ ] 新增主数据是否在 `MasterDataService` 中添加了方法？
- [ ] 是否在 `KVCachedMasterDataService` 中添加了缓存版本？
- [ ] 更新/删除操作是否自动失效缓存？
- [ ] 是否更新了 `invalidateMasterDataCache()` 方法？

### 缓存键管理
- [ ] 缓存键是否符合命名规范？
- [ ] 缓存 TTL 是否合理？

---

## ✅ 服务层组织检查

### 文件位置
- [ ] 服务文件是否放在正确的业务域目录？
- [ ] 是否在 `middleware/di.ts` 中注册？
- [ ] 导入路径是否正确？

### 服务结构
- [ ] 服务类命名是否符合规范（`XxxService.ts`）？
- [ ] 服务职责是否单一？
- [ ] 服务之间依赖是否合理？

---

## ✅ 错误处理检查

### 错误抛出
- [ ] 是否使用 `Errors` 对象抛出错误？
- [ ] 错误消息是否清晰？
- [ ] 错误代码是否正确？

### 错误处理
- [ ] 路由层是否使用 `errorHandlerV2`？
- [ ] 错误响应格式是否符合规范？

---

## ✅ API 设计检查

### 路由设计
- [ ] 路由路径是否符合 RESTful 规范？
- [ ] 路由是否在 `index.ts` 中注册？
- [ ] 路由版本是否正确（v2）？

### 权限检查
- [ ] 是否添加了权限检查？
- [ ] 权限检查是否正确？

### 请求/响应
- [ ] 请求参数验证是否完整？
- [ ] 响应格式是否符合 V2 规范（`{ success, data }`）？

---

## ✅ 代码质量检查

### 代码规范
- [ ] 代码是否符合 TypeScript 规范？
- [ ] 变量命名是否清晰？
- [ ] 函数是否单一职责？

### 注释和文档
- [ ] 复杂逻辑是否有注释？
- [ ] 函数是否有 JSDoc 注释？
- [ ] 是否需要更新文档？

---

## ✅ 测试检查

### 单元测试
- [ ] 是否添加了单元测试？
- [ ] 测试覆盖率是否足够？

### 集成测试
- [ ] 是否添加了集成测试？
- [ ] 测试是否覆盖主要流程？

---

## ✅ 性能检查

### 查询性能
- [ ] 查询是否添加了性能监控？
- [ ] 是否有慢查询告警？
- [ ] 批量操作是否优化？

### 缓存性能
- [ ] 缓存命中率是否合理？
- [ ] 缓存失效是否及时？

---

## 🚫 禁止事项检查

- [ ] 是否部分使用新工具，部分保留旧实现？
- [ ] 是否跳过了性能监控？
- [ ] 是否在 services 根目录创建了服务文件？
- [ ] 是否使用了禁止的技术（如 Prisma、Redux）？

---

## 📝 审查记录

**审查日期**: ___________  
**审查人员**: ___________  
**审查结果**: [ ] 通过 [ ] 需要修改  
**备注**: 

---

**参考文档**:
- [开发规范](./DEVELOPMENT_STANDARDS.md)
- [使用指南](./USAGE_GUIDE.md)
